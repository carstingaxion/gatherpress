(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.i18n,a=window.wp.data,l=window.wp.components,r=window.wp.plugins,s=window.wp.editPost,i=window.moment;var o=e.n(i);const c=window.wp.apiFetch;var u=e.n(c);const m=window.wp.element;function d(){(0,a.dispatch)("core/editor")?.editPost({meta:{_non_existing_meta:!0}})}function p(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function g(e,t){if("object"!=typeof GatherPress)return;const n=e.split("."),a=n.pop();n.reduce(((e,t)=>{var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={}}),GatherPress)[a]=t}const E=window.wp.date,v="YYYY-MM-DDTHH:mm:ss",_="YYYY-MM-DD HH:mm:ss",h=o().tz(b()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(v),S=o().tz(h,b()).add(2,"hours").format(v);function f(){return C(p("settings.dateFormat"))+" "+C(p("settings.timeFormat"))}function b(e=p("eventDetails.dateTime.timezone")){return o().tz.zone(e)?e:(0,n.__)("GMT","gatherpress")}function D(e=""){const t=/^([+-])(\d{2}):(00|15|30|45)$/,n=e.replace(t,"$1");return n!==e?"UTC"+n+parseInt(e.replace(t,"$2")).toString()+e.replace(t,"$3").replace("00","").replace("15",".25").replace("30",".5").replace("45",".75"):e}function P(e,t=null){!function(e){const t=o().tz(p("eventDetails.dateTime.datetime_end"),b()).valueOf(),n=o().tz(e,b()).valueOf();n>=t&&T(o().tz(n,b()).add(2,"hours").format(v))}(e),g("eventDetails.dateTime.datetime_start",e),"function"==typeof t&&t(e),d()}function T(e,t=null){!function(e){const t=o().tz(p("eventDetails.dateTime.datetime_start"),b()).valueOf(),n=o().tz(e,b()).valueOf();n<=t&&P(o().tz(n,b()).subtract(2,"hours").format(v))}(e),g("eventDetails.dateTime.datetime_end",e),null!==t&&t(e),d()}function w(){const e=(0,a.select)("core/editor").isSavingPost(),t=(0,a.select)("core/editor").isAutosavingPost();y()&&e&&!t&&u()({path:p("urls.eventRestApi")+"/datetime",method:"POST",data:{post_id:p("eventDetails.postId"),datetime_start:o().tz(p("eventDetails.dateTime.datetime_start"),b()).format(_),datetime_end:o().tz(p("eventDetails.dateTime.datetime_end"),b()).format(_),timezone:p("eventDetails.dateTime.timezone"),_wpnonce:p("misc.nonce")}}).then((()=>{!function(){const e="gp_event_communcation",t=(0,a.dispatch)("core/notices");t.removeNotice(e),"publish"!==(0,a.select)("core/editor").getEditedPostAttribute("status")||N()||t.createNotice("success",(0,n.__)("Send an event update to members via email?","gatherpress"),{id:e,isDismissible:!0,actions:[{onClick:()=>{z({setOpen:!0})},label:(0,n.__)("Compose Message","gatherpress")}]})}()}))}function C(e){const t={d:"DD",D:"ddd",j:"D",l:"dddd",N:"E",S:"o",w:"e",z:"DDD",W:"W",F:"MMMM",m:"MM",M:"MMM",n:"M",t:"",L:"",o:"YYYY",Y:"YYYY",y:"YY",a:"a",A:"A",B:"",g:"h",G:"H",h:"hh",H:"HH",i:"mm",s:"ss",u:"SSS",e:"zz",I:"",O:"",P:"",T:"",Z:"",c:"",r:"",U:"X"};return String(e).split("").map((e=>e in t?t[e]:e)).join("")}const z=(e,t="")=>{for(const[n,a]of Object.entries(e)){let e=n;t&&(e+="_"+String(t));const l=new CustomEvent(e,{detail:a});dispatchEvent(l)}},k=(e,t="")=>{for(const[n,a]of Object.entries(e)){let e=n;t&&(e+="_"+String(t)),addEventListener(e,(e=>{a(e.detail)}),!1)}};function y(){return"gp_event"===(0,a.select)("core/editor").getCurrentPostType()}function N(){const e=o().tz(p("eventDetails.dateTime.datetime_end"),b());return"gp_event"===(0,a.select)("core/editor")?.getCurrentPostType()&&o().tz(b()).valueOf()>e.valueOf()}function O(){const e="gp_event_past",t=(0,a.dispatch)("core/notices");t.removeNotice(e),N()&&t.createNotice("warning",(0,n.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!1})}const x=()=>{const{editPost:e,unlockPostSaving:r}=(0,a.useDispatch)("core/editor"),s=(0,a.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").enable_anonymous_rsvp),[]);s&&(i=p("settings.enableAnonymousRsvp"));const[o,c]=(0,m.useState)(i),u=(0,m.useCallback)((t=>{const n={enable_anonymous_rsvp:Number(t)};c(t),e({meta:n}),r()}),[e,r]);return(0,m.useEffect)((()=>{s&&0!==i&&u(i)}),[s,i,u]),(0,t.createElement)(l.CheckboxControl,{label:(0,n.__)("Enable Anonymous RSVP","gatherpress"),checked:o,onChange:e=>{u(e)}})},A=()=>(0,t.createElement)("section",null,(0,t.createElement)(x,null)),F=()=>{const{editPost:e,unlockPostSaving:r}=(0,a.useDispatch)("core/editor"),s=(0,a.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").enable_initial_decline),[]);s&&(i=p("settings.enableInitialDecline"));const[o,c]=(0,m.useState)(i),u=(0,m.useCallback)((t=>{const n={enable_initial_decline:Number(t)};c(t),e({meta:n}),r()}),[e,r]);return(0,m.useEffect)((()=>{s&&0!==i&&u(i)}),[s,i,u]),(0,t.createElement)(l.CheckboxControl,{label:(0,n.__)('Enable Immediate "Not Attending" Option for Attendees',"gatherpress"),checked:o,onChange:e=>{u(e)}})},M=()=>(0,t.createElement)("section",null,(0,t.createElement)(F,null)),Y=e=>{const{dateTimeStart:t}=e;return o().tz(t,b()).format(f())},R=e=>{const{dateTimeEnd:t}=e;return o().tz(t,b()).format(f())},j=e=>{const{dateTimeStart:n,setDateTimeStart:a}=e,r=(0,E.getSettings)(),s=/a(?!\\)/i.test(r.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(l.DateTimePicker,{currentDate:n,onChange:e=>P(e,a),is12Hour:s})},I=e=>{const{dateTimeEnd:n,setDateTimeEnd:a}=e,r=(0,E.getSettings)(),s=/a(?!\\)/i.test(r.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(l.DateTimePicker,{currentDate:n,onChange:e=>T(e,a),is12Hour:s})},H=e=>{const{dateTimeStart:a,setDateTimeStart:r}=e;return(0,m.useEffect)((()=>{r(o().tz(function(){let e=p("eventDetails.dateTime.datetime_start");return e=""!==e?o().tz(e,b()).format(v):h,g("eventDetails.dateTime.datetime_start",e),e}(),b()).format(v)),z({setDateTimeStart:a}),O()})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Flex,{direction:"column",gap:"0"},(0,t.createElement)(l.FlexItem,null,(0,t.createElement)("label",{htmlFor:"gp-datetime-start"},(0,n.__)("Start","gatherpress"))),(0,t.createElement)(l.FlexItem,null,(0,t.createElement)(l.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:e,onToggle:n})=>(0,t.createElement)(l.Button,{id:"gp-datetime-start",onClick:n,"aria-expanded":e,isLink:!0},(0,t.createElement)(Y,{dateTimeStart:a})),renderContent:()=>(0,t.createElement)(j,{dateTimeStart:a,setDateTimeStart:r})}))))},G=e=>{const{dateTimeEnd:a,setDateTimeEnd:r}=e;return(0,m.useEffect)((()=>{r(o().tz(function(){let e=p("eventDetails.dateTime.datetime_end");return e=""!==e?o().tz(e,b()).format(v):S,g("eventDetails.dateTime.datetime_end",e),e}(),b()).format(v)),z({setDateTimeEnd:a}),O()})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Flex,{direction:"column",gap:"0"},(0,t.createElement)(l.FlexItem,null,(0,t.createElement)("label",{htmlFor:"gp-datetime-end"},(0,n.__)("End","gatherpress"))),(0,t.createElement)(l.FlexItem,null,(0,t.createElement)(l.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:e,onToggle:n})=>(0,t.createElement)(l.Button,{id:"gp-datetime-end",onClick:n,"aria-expanded":e,isLink:!0},(0,t.createElement)(R,{dateTimeEnd:a})),renderContent:()=>(0,t.createElement)(I,{dateTimeEnd:a,setDateTimeEnd:r})}))))},L=e=>{const{timezone:a,setTimezone:r}=e,s=p("misc.timezoneChoices");return(0,m.useEffect)((()=>{r(p("eventDetails.dateTime.timezone"))}),[r]),(0,m.useEffect)((()=>{z({setTimezone:p("eventDetails.dateTime.timezone")})})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.SelectControl,{label:(0,n.__)("Time Zone","gatherpress"),value:D(a),onChange:e=>{e=function(e=""){const t=/^UTC([+-])(\d+)(.\d+)?$/,n=e.replace(t,"$1");if(n!==e){const a=e.replace(t,"$2").padStart(2,"0");let l=e.replace(t,"$3");return""===l&&(l=":00"),l=l.replace(".25",":15").replace(".5",":30").replace(".75",":45"),n+a+l}return e}(e),r(e),g("eventDetails.dateTime.timezone",e),d()}},Object.keys(s).map((e=>(0,t.createElement)("optgroup",{key:e,label:e},Object.keys(s[e]).map((n=>(0,t.createElement)("option",{key:n,value:n},s[e][n]))))))))},V=()=>{const[e,l]=(0,m.useState)(),[r,s]=(0,m.useState)(),[i,o]=(0,m.useState)();return(0,a.subscribe)(w),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("h3",null,(0,n.__)("Date & time","gatherpress")),(0,t.createElement)(H,{dateTimeStart:e,setDateTimeStart:l}),(0,t.createElement)(G,{dateTimeEnd:r,setDateTimeEnd:s}),(0,t.createElement)(L,{timezone:i,setTimezone:o}))},$=()=>(0,t.createElement)("section",null,(0,t.createElement)(V,null)),B=()=>{const{editPost:e,unlockPostSaving:r}=(0,a.useDispatch)("core/editor"),s=(0,a.useSelect)((e=>e("core/editor").isCleanNewPost()),[]);let i=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").max_guest_limit),[]);s&&(i=p("settings.maxGuestLimit")),!1===i&&(i=0);const[o,c]=(0,m.useState)(i),u=(0,m.useCallback)((t=>{const n={max_guest_limit:Number(t)};c(t),e({meta:n}),r()}),[e,r]);return(0,m.useEffect)((()=>{s&&0!==i&&u(i)}),[s,i,u]),(0,t.createElement)(l.__experimentalNumberControl,{label:(0,n.__)("Maximum Number of Guests","gatherpress"),value:o,min:0,max:5,onChange:e=>{u(e)}})},W=()=>(0,t.createElement)("section",null,(0,t.createElement)(B,null)),U=()=>"publish"===(0,a.select)("core/editor").getEditedPostAttribute("status")&&!N()&&(0,t.createElement)("section",null,(0,t.createElement)("h3",{style:{marginBottom:"0.5rem"}},(0,n.__)("Send an event update","gatherpress")),(0,t.createElement)(l.Button,{variant:"secondary",onClick:()=>z({setOpen:!0})},(0,n.__)("Compose Message","gatherpress"))),J=()=>{const{editPost:e,unlockPostSaving:r}=(0,a.useDispatch)("core/editor"),s=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").online_event_link)),[i,o]=(0,m.useState)(s);return k({setOnlineEventLink:o},p("eventDetails.postId")),(0,t.createElement)(l.TextControl,{label:(0,n.__)("Online event link","gatherpress"),value:i,placeholder:(0,n.__)("Add link to online event","gatherpress"),onChange:t=>{(t=>{e({meta:{online_event_link:t}}),o(t),z({setOnlineEventLink:t},p("eventDetails.postId")),r()})(t)}})},Z=()=>(0,t.createElement)("section",null,(0,t.createElement)(J,null)),X=()=>{const[e,r]=(0,m.useState)(""),[s,i]=(0,m.useState)(""),[o,c]=(0,m.useState)(""),[u,d]=(0,m.useState)(""),[p,g]=(0,m.useState)(!1),[E,v]=(0,m.useState)(""),_=(0,a.useDispatch)("core/editor").editPost,{unlockPostSaving:h}=(0,a.useDispatch)("core/editor"),S=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),f=(0,a.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",S))),b=f?.slug.replace(/^_/,""),[D,P]=(0,m.useState)(""),T=S+":"+D,w=(0,a.useSelect)((e=>e("core").getEntityRecords("postType","gp_venue",{per_page:1,slug:D})));(0,m.useEffect)((()=>{var e,t,a,l;let s={};if(D&&Array.isArray(w)){var o;const e=null!==(o=w[0]?.meta?.venue_information)&&void 0!==o?o:"{}";var u;e&&(s=JSON.parse(e),s.name=null!==(u=w[0]?.title.rendered)&&void 0!==u?u:"")}const m=null!==(e=s?.name)&&void 0!==e?e:(0,n.__)("No DEBUG_VenueSelector venue selected.","gatherpress"),p=null!==(t=s?.fullAddress)&&void 0!==t?t:"",g=null!==(a=s?.phoneNumber)&&void 0!==a?a:"",E=null!==(l=s?.website)&&void 0!==l?l:"";b&&P(b),v(T?String(T):""),r(m),i(p),c(g),d(E),z({setName:m,setFullAddress:p,setPhoneNumber:g,setWebsite:E,setIsOnlineEventTerm:"online-event"===D})}),[D,w,b,T]);let C=(0,a.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[]);return C?(C=C.map((e=>({label:e.name,value:e.id+":"+e.slug.replace(/^_/,"")}))),C.unshift({value:":",label:(0,n.__)("Choose a venue","gatherpress")})):C=[],(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.SelectControl,{label:(0,n.__)("Venue Selector","gatherpress"),value:E,onChange:e=>{(e=>{v(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];_({_gp_venue:t}),P(e[1]),h()})(e)},options:C}))},q=()=>(0,t.createElement)("section",null,(0,t.createElement)(X,null)),{Fill:K,Slot:Q}=(0,l.createSlotFill)("EventPluginDocumentSettings"),ee=({children:e,className:n})=>(0,t.createElement)(K,null,(0,t.createElement)(l.PanelRow,{className:n},e));ee.Slot=Q,(0,r.registerPlugin)("gp-event-settings",{render:()=>y()&&(0,t.createElement)(s.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,n.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(ee.Slot,null),(0,t.createElement)(l.__experimentalVStack,{spacing:6},(0,t.createElement)($,null),(0,t.createElement)(q,null),(0,t.createElement)(Z,null),(0,t.createElement)(W,null),(0,t.createElement)(A,null),(0,t.createElement)(M,null),(0,t.createElement)(U,null)))}),(0,a.dispatch)("core/edit-post").toggleEditorPanelOpened("gp-event-settings/gp-event-settings");const te=()=>{var e,r,s;const i=(0,a.useDispatch)("core/editor").editPost,o=(e,t)=>{const n=JSON.stringify({...c,[e]:t});i({meta:{venue_information:n}})};let c=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").venue_information));c=c?JSON.parse(c):{};const[u,d]=(0,m.useState)(null!==(e=c.fullAddress)&&void 0!==e?e:""),[p,g]=(0,m.useState)(null!==(r=c.phoneNumber)&&void 0!==r?r:""),[E,v]=(0,m.useState)(null!==(s=c.website)&&void 0!==s?s:"");return k({setFullAddress:d,setPhoneNumber:g,setWebsite:v}),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.TextControl,{label:(0,n.__)("Full Address","gatherpress"),value:u,onChange:e=>{z({setFullAddress:e}),o("fullAddress",e)}}),(0,t.createElement)(l.TextControl,{label:(0,n.__)("Phone Number","gatherpress"),value:p,onChange:e=>{z({setPhoneNumber:e}),o("phoneNumber",e)}}),(0,t.createElement)(l.TextControl,{label:(0,n.__)("Website","gatherpress"),value:E,type:"url",onChange:e=>{z({setWebsite:e}),o("website",e)}}))},ne=()=>(0,t.createElement)("section",null,(0,t.createElement)(te,null)),{Fill:ae,Slot:le}=(0,l.createSlotFill)("VenuePluginDocumentSettings"),re=({children:e,className:n})=>(0,t.createElement)(ae,null,(0,t.createElement)(l.PanelRow,{className:n},e));re.Slot=le,window.wp.coreData,(0,r.registerPlugin)("gp-venue-settings",{render:()=>"gp_venue"===(0,a.select)("core/editor")?.getCurrentPostType()&&(0,t.createElement)(s.PluginDocumentSettingPanel,{name:"gp-venue-settings",title:(0,n.__)("Venue settings","gatherpress"),initialOpen:!0,className:"gp-venue-settings"},(0,t.createElement)(re.Slot,null),(0,t.createElement)(l.__experimentalVStack,{spacing:6},(0,t.createElement)(ne,null)))}),(0,a.dispatch)("core/edit-post").toggleEditorPanelOpened("gp-venue-settings/gp-venue-settings"),(0,r.registerPlugin)("venue-slot-fill",{render:function(){return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l.Fill,{name:"EventPluginDocumentSettings"},(0,t.createElement)("p",null,'THE "VenuePluginDocumentSettings" in EventPluginDocumentSettings')),(0,t.createElement)(l.Fill,{name:"EventPluginDocumentSettings"},(0,t.createElement)(re.Slot,null)))}})})();